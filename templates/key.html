<article>
	<header>
		<h2>{{ rtype }}</h2>
	</header>
	<form action="{{ url_for('save', key=key) }}" method="post" 
		id="key">
		<textarea name="value" cols="60" rows="20">{{ output }}</textarea>
		<div id="controls">
			<a id="refresh" href="{{ url_for('key', key=key) }}" title="refresh">refresh</a>
			<a id="delete" href="{{ url_for('delete', key=key) }}" title="delete">delete</a>
			<input type="submit" value="save" title="save">
		</div>
	</form>
</article>

<script>
	$(function() {
		$("#refresh").live('click', function(e) {
        	var link = $(this).attr('href'),
            	hash = link.replace("/key/", "");
        	e.preventDefault();
        	$.get(link, function(data) {
            	$('#right').html(data);
            	window.location.hash = hash;
        	});
		});

		$("#delete").live('click', function(e) {
			e.preventDefault();
			e.stopPropagation();

			var link = $(this).attr("href"),
				flashes = $("#flashes");

			flashes.empty();

			if (confirm('Are you sure you want to delete this key?')) {
				$.ajax({
					url: link,
					dataType: "json",
					success: function(data) {
						$("<li>").text(data['flash']).appendTo(flashes);
						$("#keylist li.current").remove();
						window.location.hash = '';
					}
				});
			}
		});

    	$("#key").submit(function(e) {
        	e.preventDefault();

			var link = $(this).attr("action"),
				flashes = $("#flashes");

			flashes.empty();

			$.ajax({
				url: link,
				type: "POST",
				data: {
					"value": $(this).find("textarea").val()
				},
				dataType: "json",
				success: function(data) {
					$(this).find("textarea").val(data['value']);
					$("<li>").text(data['flash']).appendTo(flashes);
				}
			});
    	});
	});
</script>
